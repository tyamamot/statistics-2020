# 2020年度 統計学 中間レポート解説

<div style="text-align:right">
担当: 社会情報科学部 山本 岳洋 <br>
t.yamamoto@sis-u-hyogo.ac.jp <br>
講義ページ: <a href="https://tyamamot.github.io/statistics-2020/">https://tyamamot.github.io/statistics-2020/</a>
</div>


## 問1.（1変数データの記述と要約）
標準化されたデータ $z_1, z_2, \cdots, z_n$ の個々のデータ $z_i$ ($1 \leq i \leq n$) に対して，以下の変換を行う．

$$ t_i = 4z_i + 50 $$

このとき，変換後のデータ $t_1, t_2, \cdots, t_n$ の平均 $\bar{t}$ と標準偏差 $S_t$ を求めよ．なお，結果だけでなく途中の式も示すこと．標準化されたデータ  $z_1, z_2, \cdots, z_n$  の平均 $\bar{z}=0$, 標準偏差 $S_z=1$ は既知としてよい．

### 解答

#### 平均 $\bar{t}$

$$
\begin{align}
\bar{t} &= \frac{1}{n}\sum_{i=1}^{n}t_i \\
  &= \frac{1}{n}\sum(4z_i+50) \\
  &= 4\cdot \frac{1}{n}\sum z_i + 50
\end{align}
$$

ここで，$\frac{1}{n}\sum z_i = \bar{z}$，$\bar{z} = 0$ より，

$$
\begin{align}
\bar{t} &= 4\cdot \bar{z} + 50 \\
&= 50
\end{align}
$$

#### 標準偏差 $S_{t}$

$$
\begin{align}
S_t^2 &= \frac{1}{n}\sum_{i=1}^{n}(t_i - \bar{t})^2\\
  &= \frac{1}{n}\sum(4z_i+50 - 50)^2 \\
  &= 4^2\cdot \frac{1}{n}\sum z_i^2
\end{align}
$$

ここで，$\bar{z}=0$ より $\frac{1}{n}\sum z_i^2=\frac{1}{n}\sum(z_i-\bar{z})^2=S_z^2=1$．よって，

$$
\begin{align}
S_t^2 &= 4^2\cdot1 \\
&= 4^2
\end{align}
$$

したがって，標準偏差 $S_t$ は


$$
\begin{align}
S_t &= \sqrt{4^2} \\
&= 4
\end{align}
$$

補足: 一般に， 変数$x$を $x'=ax+b$ と変換すると平均は $\bar{x'}=a\bar{x}+b$ ，分散は $\bar{S_x'^2}=a^2S_x^2$ となります．これまでの講義で見てきたように，確率変数においても同様の性質が成り立っていますね．

## 問2. （ベイズの定理）
モンティ・ホール問題について考える．いま，回答者が扉aを選んだ．講義資料「確率の基礎」に記載したように事象を定義する．すなわち，

- 事象 $A_1$ : 扉aが正解である
- 事象 $A_2$ : 扉bが正解である
- 事象 $B$ : 司会者が 扉cを開ける

とするとき，ベイズの定理を用いて $P(A_1│B)$ と $P(A_2│B)$ をそれぞれ求めよ．そして，その結果に基づき，司会者が扉cを開けたとき，回答者は初めに選んだ扉aから扉ｂに選択を変えた方が良いかどうか解答せよ．

### 解説

$P(A_1|B)$ と $P(A_2|B)$ をそれぞれベイズの定理を用いると，下記のようになります．

$$
P(A_1  |B) = \frac{P(B|A_1)P(A_1)}{P(B)} \tag{1}
$$

$$
P(A_2  |B) = \frac{P(B|A_2)P(A_2)}{P(B)} \tag{2}
$$

上記2式には5種類の確率が登場しています．それぞれ言葉で説明すると:

- $P(A_1)$: 扉 $a$ が正解である確率．
- $P(A_2)$: 扉 $b$ が正解である確率．
- $P(B|A_1)$: 扉 $a$ が正解であるときに，司会者が扉 $c$ を開ける確率．
- $P(B|A_2)$: 扉 $b$ が正解であるときに，司会者が扉 $c$ を開ける確率．
- $P(B)$: 司会者が扉 $c$ を開ける確率．

まず，$P(A_1), P(A_2)$ について考えてみます．$P(A_1)$ も$P(A_2)$ も，司会者がどの扉を開けたかという情報がないときの，扉 $a$, $b$が正解である確率を表します．どの扉が正解かは事前に決まっており，すべて等しい確率であるので，$P(A_1)=P(A_2)=\frac{1}{3}$ です．
 - $P(A_1)$ と $P(A_1|B)$ が異なる確率を表していることに注意してください．$P(A_1|B)$ は司会者が扉 $c$ が開けられたとき，扉 $a$ が正解である確率， $P(A_1)$ は司会者が扉 $c$ が開けるという情報がないときの，扉$a$が正解である確率です．

次に，この問題のポイントである，$P(B|A_1)$ について考えてみます．$P(B|A_1)$ は，扉 $a$ が正解であるとき（事象 $A_1$ ），司会者が扉 $c$ を開ける（事象 $B$ ）確率です．いま， $a$ が正解であるとすると，回答者が $a$ を選んだときに司会者が開けることができる扉は $b$ か $c$ の2つです．従って，司会者は $b$ か $c$ を開けるので，$P(B|A_1) = \frac{1}{2}$ と計算できます．

今度は，$P(B|A_2)$ について考えてみます．今回は扉 $b$ が正解であるので，回答者が扉 $a$ を選んだときに司会者が開けることができる扉は，$c$ の1つしかない．すなわち，回答者が $a$ を選び，かつ正解が $b$ であるような状況下では，司会者の選択肢は $c$ という1つしかなく，$P(B|A_2) = 1$ となります．ここが今回のポイントで，正解が $a$ である場合は，司会者は $b$ と $c$ のどちらか一方を開けることができるのに対して，正解が $b$ であるときは司会者は $c$ しか開けることができず，$P(B|A_1)$ と，$P(B|A_2)$ が異なる値となることが分かります．

ここで，$P(A_1|B)$ と $P(A_2|B)$ の値の大小を式(1)，(2)で比べてみると，分母の $P(B)$ は共通，また，$P(A_1)=P(A_2)$ であることから，値の大小は $P(B|A_1)$ と $P(B|A_2)$ のみによって決まることが分かります． よって，$P(B|A_2)=1, P(B|A_1)=\frac{1}{2}$ であったから，この時点で$P(A_2|B)$ > $P(A_1|B)$ であることが分かります．
 - すなわち，扉 $a$ から扉 $b$ に選択を変えた方が，当たる確率は高い，しかも**2倍**も高いということが分かります．

$P(B)$ についても求めてみます．$P(B)$ は司会者が扉 $c$ を開ける確率であるから，回答者が扉 $a$ を選択したという今回の仮定のもとでは，司会者が開けられる扉は$b$と$c$の2つしかないため，$b$, $c$ を開ける確率はともに $\frac{1}{2}$ となります．これを使って $P(A_1|B), P(A_2|B)$ を実際に計算すると，

$$
P(A_1|B)=\frac{1/2\times1/3}{1/2} = \frac{1}{3}
$$

$$
P(A_2|B)=\frac{1\times1/3}{1/2} = \frac{2}{3}
$$

となることが分かります．

- ちなみに，私はこの解説を書いても，始めの選択を変えた方が良いという結果を実感として感じることはできていません・・・．確率の世界の話はしばしば，感覚と実際の結果が異なることがよくありますが，モンティ・ホール問題もそのような問題の1例です．

## 問3. （二項分布）
国民の10%がかかっていることが分かっている病気がある．以下の確率a)-c)を計算せよ．どの問題も感染者の数は二項分布に従うと仮定してよい．この問題はExcel（かGoogleスプレッドシート）を用いて二項分布の確率を計算し解答すること．

- a) 国民20人を調べたときに感染者が4人である確率はいくらか．解答はパーセントで解答し，小数点第2位まで求めればよい．
- b) 国民200人を調べたときに感染者が40人である確率はいくらか．解答はパーセントで解答し，小数点第5位まで求めればよい．
- c) 国民200人を調べたときに感染者が40人以上である確率はいくらか．解答はパーセントで解答し，小数点第5位まで求めればよい．


### 解説

Excelの`BINOM.DIST`を用います．成功確率が $p$ であるような試行を $n$ 回繰り返したときの成功回数を $X$ とすると，$X$ は二項分布 $B(n, p)$ に従います．このとき，成功回数が $k$ 回となる確率 $P(X=k)$ は`BINOM.DIST(k, n, p, FALSE)`で求められます．また，累積確率 $P(X\leq k)$ は`BINOM.DIST(k, n, p, TRUE)`で求められます．

#### a) 国民20人を調べたときに感染者が4人である確率はいくらか．

$X$ が二項分布 $B(20, 0.1)$ に従うときの，$P(X=4)$ を求めれば良いので，`BINOM.DIST(4, 20, 0.1, FALSE)` とすると， `0.0897788...`と求まります．

小数点第2位までのパーセントで表すと，答えは 8.98 % となります．

#### b) 国民200人を調べたときに感染者が40人である確率はいくらか．

今度は$X$ が二項分布 $B(200, 0.1)$ に従うときの，$P(X=40)$ を求めれば良いので，`BINOM.DIST(40, 200, 0.1, FALSE)` とすると， `9.78563...E-06`と求まります．これは補足に記載していたように，指数表示と呼ばれる表記法で，$9.78563..\times10^{-6}$ のことです．

小数点第5位までのパーセントで表すと，答えは 0.00098 % となります．

#### c) 国民200人を調べたときに感染者が40人以上である確率はいくらか．

$X$ が二項分布 $B(200, 0.1)$ に従うときの $P(40\leq X)$ が求めたい確率です．累積確率を`BINOM.DIST(k, n, p, TRUE)` で求めて，1から引けばよさそうというのは分かるのではと思いますが， 1 - `BINOM.DIST(40, 200, 0.1, TRUE)` では求める確率となっていないことに注意してください．「40人以上感染する」の余事象は，「感染者が*39人以下*である」ですので，求める確率は結局，

$$
P(40\leq X)  = 1 - P(X \leq 39)
$$

です．$P(X \leq 39)$ を `BINOM.DIST(39, 200, 0.1, FALSE)` を使って求めると`0.999982993...` となります．

この結果を使って $P(40\leq X)$ を求めると，答えは 0.00170 % となります．

## 問4. （離散型の確率変数）
離散型の確率変数 $X$ の取りうる値が $x_1, \cdots, x_n$，その確率が $p_1, \cdots, p_n$，離散型の確率変数 $Y$ の取りうる値が $y_1, \cdots, y_m$，その確率が $q_1, \cdots, q_m$ として与えられている．いま，$X$ と $Y$ が互いに独立であるとき，$E(XY)=E(X)E(Y)$ が成り立つことを示せ．

### 解答

$X$ と $Y$ が互いに独立であるので，以下が $1\leq i \leq n$, $1 \leq j \leq m$ について成立する．

$$
\begin{align}
P(X=x_i, Y=y_j) &= P(X=x_i)P(Y=y_j) \\
&= p_iq_j
\end{align}
$$

確率変数 $XY$ が取り得る値は $x_iy_j$ （$1\leq i \leq n$, $1 \leq j \leq m$）であり，その値をとる確率は上記より $p_iq_j$であるので，$XY$ の期待値 $E(XY)$　について考えると，

$$
\begin{align}
E(XY) = \sum_{i=1}^{n}\sum_{j=i}^{m} x_iy_ip_ip_j
\end{align}
$$

と表すことができる．
- 補足: 上式を $\sum$ でいきなり表すことが難しいと感じた人は，教科書p.74を参考に，まずは $\sum$ を使わずに期待値の式を作ってみてください．

$$
\begin{align}
E(XY) & = \sum_{i=1}^{n}\sum_{j=i}^{m} x_iy_ip_iq_j \\
& = \sum_{i=1}^{n}\sum_{j=i}^{m} x_ip_iy_iq_j \\
& = \sum_{i=1}^{n} x_ip_i\left(\sum_{j=i}^{m}y_iq_j\right)
\end{align}
$$

- 補足: ここの最後の式展開も同様で，よく分からない人は一旦書き下してみてください．$x_ip_i(\sum_{j=i}^{m}y_iq_j)$ = $x_ip_i(y_1q_1 + y_2q_2 + \ldots + y_mq_m)$ です．


ここで， $\sum_{j=i}^{m}y_iq_j = E(Y)$ より，

$$
\begin{align}
E(XY) & = \sum_{i=1}^{n} x_ip_i\left(\sum_{j=i}^{m}y_iq_j\right) \\
& = \sum_{i=1}^{n} x_ip_iE(Y) \\
& = E(Y)\sum_{i=1}^{n} x_ip_i
\end{align}
$$

$\sum_{i=i}^{n}x_ip_i = E(X)$ より，

$$
\begin{align}
E(XY) &= E(Y)\sum_{i=1}^{n} x_ip_i \\
 &= E(Y)E(X) \\
&= E(X)E(Y)
\end{align}
$$

よって，$E(XY) = E(X)E(Y)$ は示された．


## 問5. （正規分布その1）
政府の平成28年「国民健康・栄養調査」によると日本人の12歳男性の身長は平均150.8 cm，標準偏差8.6 cm であることが知られている．いま，12歳男性の身長が正規分布 $N(150.8,8.6^2)$  に従うと仮定し以下の問いa), b)に答えよ．なお，この問題は教科書もしくは参考書の標準正規分布表を用いて解答すること．

- 身長が133.6 cm 以上 168.0 cm 以下の日本人12歳男性の割合を求めよ．解答はパーセントで解答し，小数点第1位まで求めればよい．なお，答えだけでなく途中の考え方についても示すこと．
- 12歳男性を身長が高い順に並べたとき，上位10%以内に入るにために必要な身長はいくらか求めよ． 解答は小数点第1位まで求めればよい．なお，答えだけでなく途中の考え方についても示すこと．

### 解説

#### a) 身長が133.6 cm 以上 168.0 cm 以下の日本人12歳男性の割合

求めたい確率は， $X$が正規分布 $N(150.8, 8.6^2)$ に従うときの，$P(133.6 \leq X 168.2)$ です．$X$ を標準化した確率変数 $Z$ を

$$Z = \frac{X-\mu}{\sigma}
$$

とするとき，$Z$ は標準正規分布 $N(0, 1^2)$ に従います．
上式に $X = 133.6, X = 168.2$ を代入すると$Z$の値はそれぞれ $-2, 2$と求まりますので，求めたい確率は結局，

$$
P(-2 \leq Z \leq 2)
$$

です．以降は教科書の標準正規分布表を使用した場合で説明します．標準正規分布表で $P(0\leq Z \leq2)$ を求めると，0.4772 であることが分かるので， $P(-2 \leq Z \leq 2) = 2P(0\leq Z \leq 2)  = 0.9544$ となります．

よって，身長が133.6 cm 以上 168.0 cm 以下の日本人12歳男性の割合は 95.4 % です．


#### b)上位10%以内に入るにために必要な身長はいくらか求めよ．

求めたい値は $P(a \leq X) = 0.10$ となるような $a$ です．まず標準正規分布表で，$P(z \leq Z) = 0.10$ を満たす $z$ を求めてみます．標準正規分布表では$P(0\leq Z \leq z)$ の確率しか分かりませんので，$P(0 \leq Z \leq z) = 0.40$ となるような $z$ を求めればよいですね．標準正規分布表より， $z=1.28$ が分かります．

これを，正規分布と標準正規分布の対応の式

$$
X = \mu + Z\cdot\sigma
$$
に $z=1.28$ を当てはめると， $x = 150.8 + 8.6 \times 1.28 = 161.808$ と求まります．

よって，上位10%以内に入るにために必要な身長は 161.8 cm です．


## 問6. （正規分布その2）
問5と同じ問題設定において，以下の問いa), b)に答えよ．この問題はExcel（もしくは Googleスプレッドシート）を使って回答すること）

- a) 12歳男性を身長が高い順に並べたとき，中間の95%（上位2.5%から上位97.5%）の男性の身長は $a$ cm以上 $b$ cm以下の区間にはいる．この $a$ と  $b$ を求めよ．小数点第1位まで求めればよく，また，答えだけ記述すればよい．
- いま，ある12歳男性の身長を調べたところ 175.0 cm であった．このとき，この男性は身長の高い方から数えて上位0.5%以内に入っていると言えるかどうか調べよ．答えだけでなく途中の考え方についても示すこと．

### 解説

#### a) 中間の95%（上位2.5%から上位97.5%) 層の身長

`NORM.INV()` を用いると，ある確率 $p$ に対して $P(X \leq x)=p$ を満たす$x$が得られますので，これが使える形に $a$ と $b$ を表現すると，

$$
P(X \leq a) = 0.025 \\
P(X \leq b) = 0.975
$$

となります．それぞれ，`NORM.INV(0.025, 150.8, 9.6)`，`NORM.INV(0.975, 150.8, 9.6)` で求めてやると，

$$
\begin{align}
a &= 133.9 \ \mathrm{cm} \\
b &= 167.7  \ \mathrm{cm}
\end{align}
$$

となり，12歳男性の身長の95%は 132.0 cm 以上 167.5 cm 以下ということが分かります．

#### b)  175.0 cm は上位0.5%以内に入っているか．

`NORM.DIST()` を使っても`NORM.INV()`を使っても解答できます．

i) 175.0 cm より高い人がいる確率を調べるアプローチです．`NORM.DIST(175, 150.8, 8.6, TRUE)`より，$P(X \leq 175.0)=0.99755\ldots$ であることが分かります．つまり， $1 - P(X \leq 175.0) = 0.00245\ldots$ となり，175.0 cm より高い身長を持つ人の割合は 0.245%程度しかいないことが分かります．従って，上位0.5%以内に入っていることが分かります．

ii) ちょうど上位0.5%にくる身長がいくらかを調べるアプローチです．`NORM.INV(0.995, 150.8, 8.6)`より，$P(X \leq x)=0.995$ となる $x$ は 172.95... cm であることが分かります．いま，175.0 cm はその身長より高いですので，上位0.5%以内に入っていることが分かります．

ちなみに，問7で出題しているように，標準正規分布の有名な確率を用いて今回の問題を解く場合は，求められる確率や値が限られていますので， i) のアプローチは使えず，ii)のアプローチを用いる必要がでてきます．

## 問7. （正規分布その3）
問6のa)とb)と同様のことを， Excelや標準正規分布表を用いず，必要があれば以下を使って求めよ．また，答えだけでなく途中の考え方についても示せ．

> 確率変数 $Z$ が標準正規分布 $N(0,1)$ に従うとき，以下が知られている
>
> $P(-1.96 \leq Z \leq 1.96)=0.95$  
> $P(-2.58 \leq Z \leq 2.58)=0.99$


- a) 12歳男性を身長が高い順に並べたとき，中間の95%（上位2.5%から上位97.5%）の男性の身長は $a$ cm以上 $b$ cm以下の区間にはいる．この $a$ と $b$ を求めよ．小数点第1位まで求めればよい．答えだけでなく途中の考え方についても示すこと．
- b) いま，ある12歳男性の身長を調べたところ 175.0 cm であった．このとき，この男性は身長の高い方から数えて上位0.5%以内に入っていると言えるかどうか調べよ．答えだけでなく途中の考えかたについても示すこと．

### 解説

標準正規分布と一般的な正規分布の対応関係を理解するために，Excelや標準正規分布表を用いずとも，必要な確率が与えられただけで正規分布の確率計算や，講義後半で扱う区間推定や仮説検定が行えるようになってください．

#### a) 95%層の身長

標準化の関係式 $Z=\frac{X-\mu }{\sigma}$ を用いると，$X$ を 正規分布 $N(\mu, \sigma^2)$, $Z$ を標準正規分布 $N(0, 1^2)$ に従う確率変数とすると，

$$
P(a\leq X \leq b) = P(\frac{a-\mu }{\sigma} \leq Z \leq \frac{b+\mu }{\sigma})
$$

と成り立ちます．いま，$P(-1.96≤Z≤1.96)=0.95$ という確率が与えられていますので，

$$
\frac{a-\mu }{\sigma} = -1.96 \\
\frac{b-\mu }{\sigma} = 1.96
$$

という二つの式が得られます．これに，$\mu=150.8$, $\sigma=8.6$ を代入すると，それぞれ

$$
a = -1.96\sigma + \mu = 133.94 \ \mathrm{cm}\\
b = +1.96\sigma + \mu = 167.66 \ \mathrm{cm}\\
$$

が得られます．小数点第1位まで求めると， $a=133.9$ cm, $b=167.7$ cm です．問6の結果と一致していますね．


#### b) 上位0.5%かどうか

b) で聞かれていることは，言い換えると，身長$175.0$ cm  以上の12歳男性が0.5%より少ないかどうかです．これを式で表せば， $P(175.0 \leq X) \leq 0.005$ が成り立つかどうか，です．

標準正規分布表があれば，$P(\frac{175.0 - 150.8}{8.6} \leq Z) = P(2.814 \leq Z)$ を求めれば良いのですが，今は標準正規分布表が使えないので，別のアプローチを考える必要があります．

さて，問題文を見てみると，

$$
P(-2.58≤X≤2.58)=0.99
$$

が与えられています．この式の意味は，$Z$ が標準正規分布$N(0,1)$ に従うとき， $-2.58≤Z≤2.58$ の区間に $Z$ の値が含まれる確率は99%ということを言っていますので，正規分布の対称性から，$2.58\leq Z$ の区間には残りの1%の半分，つまり0.5%が含まれることがわかります．

したがって，以下が成り立っていることが分かります．
$$
P(2.58 \leq Z) = 0.005
$$

この式の意味は，標準正規分布上では $Z=2.58$ がちょうど上位0.5%の値ということですので，これを $X=\sigma Z+\mu$ の関係を用いて正規分布 $N(150.8,8.6^2)$ 上の確率で表現すると,

$$
P(2.58 \leq Z) = P(2.58\sigma + \mu \leq X) = 0.005
$$

これに，$\mu=150.8$, $\sigma=8.6$ を代入すると，

$$
\begin{align}
P(2.58\cdot8.6 + 150.8 \leq X) &= 0.005 \\
P(172.99 \leq X) &= 0.005
\end{align}
$$

となり，ちょうど上位 0.5% にあたる12歳男性の身長は 172.99 cm であることが分かります．いま聞かれている身長は 175.0 cm で 172.99 cm より高いですので，最終的な結論としては，この男性の身長は `上位 0.5% に含まれていると言える` です．


正規分布の確率計算は本講義「統計学」において非常に重要です．問5〜問7はサラサラとできるようになってください．数式だけだと考えづらいこともあるかと思いますが，求めたい確率を図示するようにしてみると，整理されると思います．


## 発展課題その1.（順位相関係数）
以下は，ある食堂の8つのメニューについて，２名の教員に順位付けしてもらった結果である．

教員E:  1位. チキン香草焼き，2位. 塩だれカツ丼，3位. 鯖生姜煮，4位. 麻婆豆腐，5位. 県大唐揚げ，6位.カレーライス，7位. ダッカルビ風野菜炒め，8位. ロースカツカレー

教員O:  1位. 県大唐揚げ ，2位. チキン香草焼き，3位. ダッカルビ風野菜炒め，4位. 麻婆豆腐，5位. 塩だれカツ丼，6位. ロースカツカレー，7位. 鯖生姜煮，8位. カレーライス

さて，２つの順序の相関関係を測る尺度として，スピアマンの順位相関係数やケンドールの順位相関係数と呼ばれる尺度が知られている．各自どちらか一方の順位相関係数について調べよ．そして，上記の8つのメニューを自分の好みでランキングし，自分の好みが教員Eと教員Oの好みとどちらか近いか順位相関係数を実際に計算して確認してみよ．

### 解説

ここではスピアマンの順位相関係数について解説します．順位相関を計算するためのデータとして，以下の様な教員Yのランキングを使って，教員Eと教員Yとの相関係数を計算してみます．

教員Y:  1位. 県大唐揚げ ，2位. ロースカツカレー， 3位. カレーライス 4位. ダッカルビ風野菜炒め，5位. 麻婆豆腐，6位. チキン香草焼き，7位. 塩だれカツ丼，8位. 鯖生姜煮，


3名の教員が各メニューに対して何位と評価したのかを表にまとめると以下の様になります．

| メニュー               | 教員E | 教員O | 教員Y |
| ---------------------- | ----- | ----- | ----- |
| 1.チキン香草焼き       | 1     | 2     | 6     |
| 2.塩だれカツ丼         | 2     | 5     | 7     |
| 3.鯖生姜煮             | 3     | 7     | 8     |
| 4.麻婆豆腐             | 4     | 4     | 5     |
| 5.県大唐揚げ           | 5     | 1     | 1     |
| 6.カレーライス         | 6     | 8     | 3     |
| 7.ダッカルビ風野菜炒め | 7     | 3     | 4     |
| 8.ロースカツカレー     | 8     | 6     | 2     |


いま，$x$がデータ$i$につけた順位を$x_i$，$y$がデータ$i$につけた順位を$y_i$と書くことにします．たとえば，メニューが上記表のように並んでいて，$x$を教員Eだとすると 1番目のデータはチキン香草焼きですので $x_i=1$　となり，$y$を教員Oだとすると$y_1=2$ となります．

$n$をデータの個数とするとき，スピアマンの順位相関係数 $\rho$ は，以下の式で計算されます．

$$
\rho = 1 - \frac{6}{n(n^2-1)}\sum_{i=1}^{n}(x_i - y_i)^2
$$

式中の，$(x_i - y_i)$ は同じデータに対する$x$と$y$の順位の差です．全てのデータに対して $x$ と $y$ で順位の差が全くなければ $\rho=1$ となり，完全に真逆の順位付けであれば $\rho=-1$ となります．

さて，このスピアマンの順位相関係数で教員Yの好みが教員Eと教員Oのどちらの好みの近いか調べてみると

- 教員Yと教員Eのスピアマンの相関係数: -0.738
- 教員Yと教員Oのスピアマンの相関係数: +0.238

となり，教員Oの好みと近いことが分かります．

このように，順位相関係数を用いることで，順序尺度に対するデータについても相関係数を求めることができます．なお，スピアマンの順位相関係数ですが，実はこの式はピアソンの相関係数の特殊な場合になっています．具体的には，間隔尺度や比例尺度のデータを「順位」に落とし込み，ピアソンの相関係数を計算したものがスピアマンの順位相関係数となっています．実際，上記表のデータに対して，Excelでピアソンの相関係数を求める`CORREL`関数を使って教員間のピアソンの相関係数を求めてみると，スピアマンの順位相関係数の式で求めた結果と一致します．

ケンドールの順位相関係数についても簡単に説明しておきます．ケンドールの順位相関係数，2つのデータ間の順序関係が$x$と$y$で保たれている数をみます．たとえば，「チキン香草焼き」と「麻婆豆腐」のペアについてみてみると，教員Eも教員Oも「チキン香草焼き」の順位が高くなっており，この2つのメニューの順序関係は一致しています．一方「チキン香草焼き」と「県大唐揚げ」のペアについてみてみると，教員Eは「チキン香草焼き」の方が高い順位となっているのに対して教員Eは「チキン香草焼き」の方が低い順位となっており，順序関係が一致していません．ケンドールの順位相関係数は，このように，データのペアのうち，順序関係が保たれているペアの数を調べます．

今回の例では，一人の教員が二つの商品を同じ順位にすることを想定していませんでしたが，実際のデータでは複数の商品が同じ順位となることがあります．スピアマンの順位相関係数もケンドールの順位相関係数も，そのような同順位がある場合は順位の表し方にいろいろと方法があるので，実際に使用するときには注意が必要です．


## 発展課題その2.（回帰直線の導出）
最小二乗法による回帰直線の $a$ および $b$ を導出せよ．具体的には，誤差関数 $L$ を $a$ の二次関数 $L(a)$，$b$ の二次関数 $L(b)$ とみなし，$\frac{\mathrm{d}L(a)}{\mathrm{d}a}=0$, $\frac{\mathrm{d}L(b)}{\mathrm{d}b}=0$ という2つの方程式から得られる連立方程式を解くことで，$a$ および $b$ が講義資料の結果と一致することを確かめよ．

### 解説

データ $(x_1, y_1), \ldots (x_n, y_n)$ が与えられた際に，2つの変数 $x$ と $y$ の関係を表す直線 $y=ax+b$を回帰直線といいます（$x$ から $y$ を予測するための直線と理解してもよいです）．最小二乗法は，回帰直線 $y=ax+b$ の $a$ と $b$ を，以下の誤差関数 $L$ を最小化することで求めます．

$$
L = \sum_{i=1}^{n}(y'_i - y_i)^2  \ \ \ \ \ \ \ \ （ただし，y'_i = ax_i+b）
$$

上式に，$y'_i = ax_i+b$ を代入すると，

$$
L = \sum_{i}(ax_i+b- y_i)^2
$$

となります．最小二乗法とは，上記 $L$ を最小化するような 回帰直線 $y=ax+b$ を求めること言います．$L$ を最小化するということはすなわち，回帰直線で予測される $y_i'$ と，実際のデータ $y_i$ の差（正確には，差の二乗）の和を最小化するということであり，$L$ が小さければ小さいほど，回帰直線は与えられらデータ $(x_1, y_1), \ldots (x_n, y_n)$ を上手く予測できることを意味します．この最小二乗法における「誤差関数を最小化する」という考え方は，みなさんが今後学習するであろう機械学習のアプローチの1つとして非常に重要ですので，是非とも頭の片隅にでも入れておいてください．

---
（ここからは高校数学を少し超えた内容となります．現時点で興味があるひとだけ参照してください．といっても 2次関数 $f(x)=ax^2 + bx + c$ の微分さえできれば解くことができますので，それをしてもらった，というのが今回の発展課題です．）

さて，この $L$ ですが，$a$ と $b$ という2つの変数を含んだ関数と見なすことができます．
皆さんは高校数学で 「$f(x)=ax^2 + bx + c$  (ただし$a>0$) が最小となる $x$ を求めよ」という問題を解いたことがあるかと思います．直感的には，今回の $L$ も同様に，$a$ と $b$ で微分することによって，$L$ が最小となるような $a$ と $b$ を求めることができます．

$L$ を $a$ の関数 $L(a)$ としてみてみると，

$$
\begin{align}
L(a) &= \sum_{i}(ax_i+b- y_i)^2 \\
&= \sum_{i}(x_i^2a^2+2(x_ib-x_iy_i)a+b^2+y_i^2-2by_i) \\
&= (\sum_{i}x_i^2)a^2 + 2\bigl(\sum_{i}(bx_i-x_iy_i)\bigr)a + aを含まない定数項
\end{align}
$$

同様に，$L$ を $b$ の関数 $L(b)$ としてみてみると，

$$
\begin{align}
L(b) &= \sum_{i}(ax_i+b- y_i)^2 \\
 &= \sum_{i}(b^2 + 2(ax_i-y_i)b + x_i^2a^2 + y_i^2 - 2ax_iy_i) \\
  &= nb^2 + 2\bigl(\sum_{i}(ax_i-y_i)\bigr)b + bを含まない定数項
\end{align}
$$

となり，$\sum$ があるのでややこしく見えますが，それぞれ $a$ と $b$ の2次関数としてみることができます．$f(x)=ax^2 + bx + c$ を最小とするような $x$ を求めるには $f(x)$ を $x$ で微分し，
$\frac{\mathrm{d}f(x)}{\mathrm{d}x}=0$ となるような $x$ を求めればよいように，今回の問題では $L(a)$ を $a$ で微分，$L(b)$ を $b$ で微分すれば，$L$ を最小とするような $a$ と $b$ が求まります．
 - ある変数 $a$ だけに着目し，他の変数を定数とみなして変数 $a$ で関数を微分する方法を「偏微分」といいます（おそらく後期の講義「微積分」で習うのではと思います）．今回おこなう，$L(a)$ を $a$ で微分，$L(b)$ を$b$ で微分という方法は，まさにこの偏微分です．

さて，いまやりたいことは，$L(a)$ を $a$ で（偏）微分，$L(b)$ を $b$ で（偏）微分し，それぞれ $0$ となるときの $a$ と $b$ を求めることです．式であらわすと，下記の2式を解くことです．

$$
\frac{\partial L(a)}{\partial a} = 0
$$

$$
\frac{\partial L(b)}{\partial b} = 0
$$

- 普通の微分が $\frac{\mathrm{d}f(x)}{\mathrm{d}x}$ と表すのに対して，偏微分は $\frac{\partial f(x)}{\partial x}$ と表します．記法は異なりますが，やっていることは関数 $f(x)$ を変数 $x$ で微分するという，いわゆる微分です．$\partial$は「ディー」とか「パーシャルディー」と呼びます（参考: https://ja.wikipedia.org/wiki/%E2%88%82 ）

まず，$\frac{\partial L(a)}{\partial a} = 0$ を解いてみましょう．$L$は

$$
\begin{align}
L(a) &= (\sum_{i}x_i^2)a^2 + 2\bigl(\sum_{i}(x_ib-x_iy_i)\bigr)a + aを含まない定数項
\end{align}
$$

と表せるので，これを $a$ で微分すると，

$$
\begin{align}
\frac{\partial L(a)}{\partial a}
&= 2(\sum_{i}x_i^2)a+2\sum_{i}(x_ib-x_iy_i) \\
&= 2n\bar{x^2}a + 2n\bar{x}b-2\sum_{i}x_iy_i \ \ \ ( \frac{1}{n}\sum_{i}x_i^2 = \bar{x^2}，\frac{1}{n}\sum_{i}x_i = \bar{x} を用いた)
\end{align}
$$

ここで，
$$
\frac{\partial L(a)}{\partial a} = 0
$$

とおくと，

$$
2n\bar{x^2}a + 2n\bar{x}b-2\sum_{i}x_iy_i = 0 \tag{1}
$$

次に，$\frac{\partial L(b)}{\partial b} = 0$ を解いてみましょう．

$$
\begin{align}
L(b)  &= nb^2 + 2\bigl(\sum_{i}(ax_i-y_i)\bigr)b + bを含まない定数項 \\
\end{align}
$$

とあらわせるので，これを $b$ で微分すると
$$
\begin{align}
\frac{\partial L(b)}{\partial b} &= 2nb+2\sum_{i}(ax_i-y_i) \\
&= 2nb + 2na\bar{x} - 2n\bar{y} \ \ \ \ (\bar{x} = \frac{1}{n}\sum_{i}x_i, \bar{y} = \frac{1}{n}\sum_{i}y_i を用いた)
\end{align}
$$


ここで，
$$
\frac{\partial L(b)}{\partial b} = 0
$$

とおくと，

$$
2nb + 2na\bar{x} - 2n\bar{y} = 0
$$

より

$$
b = \bar{y} - a\bar{x} \tag{2}
$$

ここで得られた $b$ の関係式はまさに講義資料の式そのものですね．式(1)と(2)より， $a$ と $b$ を含んだ方程式が2つ得られるので，この2式の連立方程式を解くことで，$a$ と $b$ の具体的な値が求められます．$a$ についてみてみましょう．


式(1)に式(2)を代入すると，

$$
\begin{align}
2n\bar{x^2}a + 2n\bar{x}(\bar{y}-a\bar{x})-2\sum_{i}x_iy_i = 0
\end{align}
$$

ここで，$nS_{xy}=\sum_{i}x_iy_i-n\bar{x}\bar{y}$ より $\sum_{i}x_iy_i = nS_{xy} +n\bar{x}\bar{y}$  を上式に代入すると

$$
2n\bar{x^2}a + 2n\bar{x}(\bar{y}-a\bar{x})-2(nS_{xy} +n\bar{x}\bar{y}) = 0
$$

$$
(\bar{x^2}-\bar{x}^2)a - S_{xy}= 0
$$

上式に $S_{x}^{2} = \bar{x^2} - \bar{x}^2$ （分散の公式ですね）を代入して整理すると，最終的に以下が得られます．

$$
a=\frac{S_{xy}}{S_x^2}
$$

以上で $a$ と $b$ が求められました．

## 発展課題その3. （離散型の確率変数）
離散型の確率変数 $X$ と $Y$ が互いに独立であるとき， $V(X-Y)=V(X)+V(Y)$ が成り立つことを示せ．なお，期待値の線形性や加法性，$X$ と $Y$ が互いに独立であるとき $E(XY)=E(X)E(Y)$ が成り立つことなどは既知としてよい．

### 解答

$V(X) = E(X^2)-E(X)^2$より，

$$
\begin{align}
V(X-Y) &= E((X-Y)^2) - E(X-Y)^2 \tag{1}
\end{align}
$$

(1)式の右辺第一項は，

$$
E((X-Y)^2) = E(X^2 - 2XY +  Y^2)
$$

となる．ここで，期待値の加法性 $E(X+Y)=E(X) + E(Y)$ より，

$$
E(X^2 - 2XY +  Y^2) = E(X^2) - E(2XY) +  E(Y^2) \tag{2}
$$

また， $E(aX) = aE(X)$ より $E(2XY)=2E(XY)$．さらに，いま $X$ と $Y$ は互いに独立であるから $E(XY)=E(X)E(Y)$． よって，式(2)は以下のようになる．

$$
E((X-Y)^2) = E(X^2) - 2E(X)E(Y) +  E(Y^2) \tag{3}
$$

次に，(1)式の右辺第二項の $E(X-Y)$ について考える．期待値の加法性より $E(X-Y)=E(X)-E(Y)$．したがって，第二項は

$$
\begin{align}
E(X-Y)^2 &= (E(X)-E(Y))^2 \\
 &=E(X)^2-2E(X)E(Y)+E(Y)^2 \tag{4}
\end{align}
$$


式(3)と式(4)を式(1)に代入すると，

$$
\begin{align}
V(X-Y) &= E((X-Y)^2) - E(X+Y)^2 \\
&=  E(X^2) - 2E(X)E(Y) +  E(Y^2)  - (E(X)^2-2E(X)E(Y)+E(Y)^2) \\
&=  E(X^2) - E(X)^2 +  E(Y^2)  - E(Y)^2 \\
&= V(X) + V(Y)
\end{align}
$$

よって，$V(X-Y) = V(X) + V(Y)$ は示された．

- 補足:今回の課題は $V(X-Y)=V(X)+V(Y)$ を示す問題でしたが，$V(X+Y)=V(X)+V(Y)$ も同じ手順で示すことができます．このように，確率変数が互いに独立のとき，確率変数の和や差の分散はそれぞれの分散の和に一致します．このような性質を分散の加法性と呼びます．
- （以下は参考程度）: なお，今回の導出のどの部分で確率変数の独立性を用いていたか分かりましたでしょうか． $2E(XY)=2E(X)E(Y)$ のところですね．確率変数が独立であるとき，$E(XY)=E(X)E(Y)$ は常に成り立ちます．一方，確率変数 $X$，$Y$ が独立でないとき， $E(XY)=E(X)E(Y)$ が成り立つ場合もあればそうでない場合もあります．$E(XY)=E(X)E(Y)$ が成り立つとき，確率変数 $X$と$Y$は**無相関**であると呼びます．確率変数 $X$と$Y$が独立であるとき無相関は常に成り立ちますが， $X$と$Y$ が無相関であるとき常に独立であるとは限りません．


## 発展課題その4.（正規分布の確率，期待値，分散の確認）
ガウス積分と呼ばれる以下の公式が知られている：


$$
\int_{-\infty}^{+\infty}e^{-ax^2}dx = \sqrt{\frac{\pi}{a}}
$$

この公式を用いて，確率変数 $X$ が正規分布 $N(\mu, \sigma^2)$ に従うとき，
$\int_{-\infty}^{+\infty}f(x)dx = 1$ となっていること，また，期待値，分散がそれぞれ $\mu, \sigma^2$ となっていることを示せ．

### 解説

正規分布 $N(\mu, \sigma^2)$ の確率密度関数は以下の式で表されます．

$$
f(x) = \frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-(x-\mu)^2}{2\sigma^2}\right)
$$


この確率密度関数を使って，a) $P(-\infty\leq X \leq +\infty)=1$， b) 期待値 $E(X)=\mu$ , c) 分散 $V(X)=\sigma^2$ を示す，という課題です．本来であれば，広義積分を習わないと解けないのですが，ここでは公式として，ガウス積分と呼ばれる下記の公式を使用することで解いてみます．

$$
\int_{-\infty}^{+\infty}\exp(-ax^2)dx = \sqrt{\frac{\pi}{a}}
$$


#### a) 確率となっていること（足したら1になっていること）の確認

$$
\begin{align}
P(-\infty\leq X \leq +\infty) = \int_{-\infty}^{+\infty}f(x)dx &= 1 \\
\end{align}
$$

つまり，

$$
\begin{align}
\int_{-\infty}^{+\infty}\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-(x-\mu)^2}{2\sigma^2}\right)dx &= 1 \tag{1}
\end{align}
$$

を示すことが 課題 a) です．このままだと $\exp(\cdot)$ の中身が煩雑でどうしようもなさそうなので，


$$
z = \frac{x-\mu}{\sigma}
$$

と置いて置換積分してみます．このとき，$\frac{dz}{dx}=\frac{1}{\sigma}$ より，$dx=\sigma \cdot dz$ が成り立ちます．また積分区間は $[-\infty, +\infty]$ のまま変わりません．さらに，$x=\sigma\cdot z + \mu$です．

式(1)を $z$ に置換すると，

$$
\begin{align}
\int_{-\infty}^{+\infty}f(x)dx &=
\int_{-\infty}^{+\infty}\frac{1}{\sqrt{2\pi\sigma^2}}\exp(-\frac{z^2}{2})\sigma\cdot dz \\
& = \frac{1}{\sqrt{2\pi}}\int_{-\infty}^{+\infty}\exp(-\frac{z^2}{2})\cdot dz \tag{2}
\end{align}
$$

さて，ここで，ガウス積分より

$$
\int_{-\infty}^{+\infty}\exp(-\frac{x^2}{2})dx = \sqrt{2\pi}
$$

が成り立つので，式(2)に代入すると，

$$
\begin{align}
\int_{-\infty}^{+\infty}f(x)dx &=
\frac{1}{\sqrt{2\pi}}\cdot \sqrt{2\pi} \\
&= 1
\end{align}
$$

となります．


#### b) 期待値 $E(X)=\mu$

連続型の確率変数 $X$ の期待値 $E(X)$ は，

$$
E(X) = \int_{-\infty}^{+\infty}xf(x)dx
$$

と定義されます．これに，正規分布の確率密度関数を代入すると，

$$
\int_{-\infty}^{+\infty}x\cdot\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-(x-\mu)^2}{2\sigma^2}\right)dx = \mu \tag{3}
$$

を示すことがここでの課題です．

さて，先ほどと同様に $z$ に置き換えてみると，いま $x=\sigma z + \mu$ より


$$
\begin{align}
E(X) &= \int_{-\infty}^{+\infty}(\sigma z + \mu)\cdot\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{z^2}{2}\right)\sigma\cdot dz \\

&= \frac{\sigma}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z\cdot \exp\left(-\frac{z^2}{2}\right)dz +  \frac{\mu}{\sqrt{2\pi}}\int_{-\infty}^{+\infty}\exp(-\frac{z^2}{2}) dz  \tag{4}

\end{align}
$$

さて，式(4)について，右辺第2項は， a) にて

$$
\int_{-\infty}^{+\infty}\exp(-\frac{x^2}{2})dx = \sqrt{2\pi}
$$

であることが分かっているので，

$$
\begin{align}
\frac{\mu}{\sqrt{2\pi}}\int_{-\infty}^{+\infty}\exp(-\frac{z^2}{2})\cdot dz &=
\frac{\mu}{\sqrt{2\pi}}\cdot\sqrt{2\pi} \\
&= \mu
\end{align}
$$

となることが分かります．いま，我々は期待値 $E(X)=\mu$ であることを知っているので，そうすると第1項

$$
\frac{\sigma}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z\cdot \exp\left(-\frac{z^2}{2}\right)dz
$$

は 0 になるはずです．ここで，$g(x)=x\exp(-\frac{x^2}{2})$ とおくと，

$$
\begin{align}
g(-x) &=(-x)\exp(-\frac{(-x)^2}{2}) \\
&=-x\exp(-\frac{x^2}{2}) \\
&=-g(x)
\end{align}
$$

となり，$g(x)=-g(-x)$ が成り立つので $g(x)$ は奇関数であることが分かります．よって，$\int_{-\infty}^{+\infty}g(x)dx=0$ となり第1項は0となります．
- 補足: 厳密には，今回の奇関数について $\int_{-\infty}^{+\infty}g(x)dx=0$ を言うには広義積分の定義から積分値が収束するかどうかを判定する必要があります．

最終的に，

$$
\begin{align}
E(X) &= \frac{\sigma}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z\cdot \exp\left(-\frac{z^2}{2}\right)dz +  \frac{\mu}{\sqrt{2\pi}}\int_{-\infty}^{+\infty}\exp(-\frac{z^2}{2})\cdot dz  \\

&= 0 + \mu \\

&= \mu
\end{align}
$$

となります．


#### 分散 $V(X)=\sigma^2$

連続型の確率変数 $X$ の分散 $V(X)$ は，期待値 $E(X)=\mu$ とおくと，

$$
V(X) = \int_{-\infty}^{+\infty}(x-\mu)^2f(x)dx
$$

と定義されます．このまま置換積分を行ってもよいのですが，いま $E(X)=\mu$ と分かっているので，

$$
\begin{align}
V(X) &= E(X^2) - E(X)^2 \\
&= E(X^2) - \mu^2
\end{align}
$$

より，$E(X^2) = \sigma^2 + \mu^2$ を示す方が楽そうです（実際は直接置換積分で解いてもほとんど同じだと思います）．さて， $E(X^2)$ は，

$$
\begin{align}
E(X^2) &=  \int_{-\infty}^{+\infty}x^2f(x)dx \\
&=  \int_{-\infty}^{+\infty}x^2\cdot\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-(x-\mu)^2}{2\sigma^2}\right)dx
\end{align}
$$

これを $z$ で置換すると，

$$
\begin{align}
E(X^2) &= \int_{-\infty}^{+\infty}(\sigma^2z^2+2\sigma\mu z + \mu^2)\cdot\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{z^2}{2}\right)\sigma\cdot dz \\
&= \frac{\sigma^2}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z^2\exp\left(-\frac{z^2}{2}\right)dz \\
&+ \frac{2\sigma\mu}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z\exp\left(-\frac{z^2}{2}\right)dz \\
&+\frac{\mu^2}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}\exp\left(-\frac{z^2}{2}\right)dz \tag{5}

\end{align}
$$

式(5)について，これまでの議論で右辺第2項の積分は0，第3項は $\frac{\mu^2}{\sqrt{2\pi}}\cdot\sqrt{2\pi}=\mu^2$ と分かります．

従って，

$$
E(X^2) = \frac{\sigma^2}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z^2\exp\left(-\frac{z^2}{2}\right)dz + \mu^2 \tag{6}
$$

ここで，右辺第1項にある積分:

$$
 \int_{-\infty}^{+\infty}x^2\exp\left(-\frac{x^2}{2}\right)dx
$$

について考えてみます（なお，$z$ を $x$ に記載し直しています）．一見すると，どうしようもなさそうですが，部分積分という公式

$$
\int_{a}^{b}f(x)g'(x)dx= \left[ f(x)g(x) \right]_{a}^{b} - \int_{a}^{b}f'(x)g(x)dx
$$

を用いることで解くことができます．ここで，


$$
g(x)=\exp(-\frac{x^2}{2})
$$

とおくと，

$$
\frac{dg(x)}{dx} = -x\exp(-\frac{x^2}{2})
$$

より，$g(x)' = -xg(x)$ が成り立つことが分かります．

そこで，

$$
 \int_{-\infty}^{+\infty}x^2\exp\left(-\frac{x^2}{2}\right)dx
$$

を

$$
 \int_{-\infty}^{+\infty}x\cdot x\exp\left(-\frac{x^2}{2}\right)dx
$$

とみてやり，$f(x) = x$, $g(x)=\exp(-\frac{x^2}{2})$ とおけば，

$$
\begin{align}
 \int_{-\infty}^{+\infty}x\cdot x\exp\left(-\frac{x^2}{2}\right)dx
 &=  \int_{-\infty}^{+\infty} f(x)(-g(x)')dx \\
 &= -  \left[ f(x)g(x)\right]_{-\infty}^{+\infty} +  \int_{-\infty}^{+\infty} f(x)'g(x)dx \\
 &= -\left[x\exp(-\frac{x^2}{2}) \right]_{-\infty}^{+\infty}
 + \int_{-\infty}^{+\infty} x'\exp(-\frac{x^2}{2})dx \\
 &= -\left[x\exp(-\frac{x^2}{2}) \right]_{-\infty}^{+\infty}
 + \int_{-\infty}^{+\infty}\exp(-\frac{x^2}{2})dx \tag{7}
\end{align}
$$

が得られます．

<p style="background-color:grey">&nbsp</p>

補足: 申し訳ございません．この式(7)の右辺第一項に表れている $\left[x\exp(-\frac{x^2}{2}) \right]_{-\infty}^{+\infty}$ は $0$ になるのですが，これは高校数学の範囲を超えてしまっていました．この式は，

$$
\lim_{x \rightarrow \pm \infty} x \exp(-\frac{x^2}{2})=0
$$

が成立するので，$-\left[x\exp(-\frac{x^2}{2}) \right]_{-\infty}^{+\infty} = 0$ となるのですが，この極限の証明は高校数学までの知識では解けなかったと思います（この極限を証明してくれた学生さんは大変素晴らしいと思います）．おそらく1回生後期や2回生前期の微積分で，広義積分を学ぶ際に触れることがあるのではと思います．以下は，私なりの証明です．


まず， $x\geq0$ において $\exp(x) \geq \frac{x^2}{2}+x+1$ を示す． $f(x)= \exp(x)-\frac{x^2}{2}-x-1$ とおくと， $f'(x)= \exp(x)-x-1$，$f''(x)=\exp(x)-1$ となる．$f'(x)$ についてみると， $f''(0)=1$より $x\geq0$において$f''(x)\geq0$であるので，$f'(x)$ は $x=0$で最小値 $f'(0)=0$ をとる．また，$f(0)=0$ より $f(x)\geq0$．すなわち，$\exp(x) \geq \frac{x^2}{2}+x+1$ が成立する．等号成立は $x=0$．

これより，$x>0$において $\frac{\exp(x)}{x}>\frac{\frac{x^2}{2}+x+1}{x}$ である．
いま，  $\lim_{x \rightarrow +\infty}\frac{\frac{x^2}{2}+x+1}{x}=\lim_{x \rightarrow +\infty}(\frac{x}{2}+1+\frac{1}{x})=\infty$ より，はさみうちの原理より，

$$
\lim_{x \rightarrow +\infty}\frac{\exp(x)}{x} = \infty
$$

が成り立つ．よって，$\lim_{x \rightarrow +\infty}(\frac{\exp(x)}{x})^{-1}=\lim_{x \rightarrow +\infty}\frac{x}{\exp(x)}=\lim_{x \rightarrow +\infty}x\exp(-x)=0$ である．

ここで，$x>0$ において $0 < \exp(-x^2) < \exp(-x)$ より $0 < x\exp(-x^2) < x\exp(-x)$ となるので，
はさみうちの原理より
$\lim_{x \rightarrow +\infty}x\exp(-x^2)=0$.
ここで，$x=\frac{1}{\sqrt{2}}t$ とおくと，
$\lim_{t \rightarrow +\infty}\frac{1}{\sqrt{2}}t\exp(-\frac{t^2}{2})=0$

よって，$\lim_{x \rightarrow +\infty}x\exp(-\frac{x^2}{2})=0$ が分かる．
$g(x)=x\exp(-\frac{x^2}{2})$ とおくと，$g(-x)=-x\exp(-\frac{x^2}{2})=-g(x)$ である．よって，

$$
\begin{align}
\lim_{x \rightarrow -\infty}x\exp(-\frac{x^2}{2}) &= \lim_{t \rightarrow +\infty}-(t\exp(-\frac{t^2}{2})) \\
&= 0
\end{align}
$$

よって，$\lim_{x \rightarrow \pm \infty} x \exp(-\frac{x^2}{2})=0$ となるので， $\left[x\exp(-\frac{x^2}{2}) \right]_{-\infty}^{+\infty}=0$ ．

<p style="background-color:grey">&nbsp</p>


さて，式(7)の右辺第1項は0になることが分かりました．また，右辺第2項も $\sqrt{2\pi}$ となることが分かっています．したがって，

$$
\begin{align}
 \int_{-\infty}^{+\infty}x^2\exp\left(-\frac{x^2}{2}\right)dx = \sqrt{2\pi}
\end{align}
$$


となり，この結果を式(6)に代入すると，

$$
\begin{align}
E(X^2) &= \frac{\sigma^2}{\sqrt{2\pi}} \int_{-\infty}^{+\infty}z^2\exp\left(-\frac{z^2}{2}\right)dz + \mu^2 \\  &= \frac{\sigma^2}{\sqrt{2\pi}}\cdot\sqrt{2\pi}  + \mu^2  \\
&= \sigma^2 + \mu^2
\end{align}
$$

となり，$E(X^2)=\sigma^2 + \mu^2$ を示すことができました．よって，最終的に

$$
\begin{align}
V(X) &= E(X^2) - E(X)^2 \\
&= \sigma^2 + \mu^2 - \mu^2 \\
&= \sigma^2
\end{align}
$$

となり，正規分布の分散が $\sigma^2$ となることを示すことができました．
